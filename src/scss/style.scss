// CoreUI Base (keep for compatibility)
@use "@coreui/coreui/scss/coreui" as * with (
  $enable-deprecation-messages: false,
);
@use "@coreui/chartjs/scss/coreui-chartjs";
@use "vendors/simplebar";

// Shadcn Design System
@use './shadcn-variables';
@use './shadcn-globals';
@use './shadcn-sidebar';
@use './shadcn-header';

// Override CoreUI with Shadcn styles
body {
  background-color: var(--background);
  color: var(--foreground);
  font-family: var(--font-sans);
}

.wrapper {
  width: 100%;
  padding-inline: var(--cui-sidebar-occupy-start, 0) var(--cui-sidebar-occupy-end, 0);
  will-change: auto;
  @include transition(padding .15s);
  background-color: var(--background);
}

.body {
  background-color: var(--background);
  padding: var(--spacing-lg);
  min-height: calc(100vh - var(--header-height));

  @media (max-width: 640px) {
    padding: var(--spacing-md);
  }
}

// Header overrides
.header > .container-fluid,
.sidebar-header {
  min-height: var(--header-height);
  background-color: var(--card);
}

.sidebar-brand-full {
  margin-left: 3px;
}

.sidebar-header {
  .nav-underline-border {
    --cui-nav-underline-border-link-padding-x: 1rem;
    --cui-nav-underline-border-gap: 0;
  }

  .nav-link {
    display: flex;
    align-items: center;
    min-height: var(--header-height);
  }
}

.sidebar-toggler {
  margin-inline-start: auto;
}

.sidebar-narrow,
.sidebar-narrow-unfoldable:not(:hover) {
  .sidebar-toggler {
    margin-inline-end: auto;
  }
}

.header > .container-fluid + .container-fluid {
  min-height: 3rem;
}

.footer {
  min-height: calc(3rem + 1px);
  background-color: var(--card);
  border-top: 1px solid var(--border);
}

// Sidebar styling overrides
.sidebar {
  background-color: var(--card);
  border-right: 1px solid var(--border);

  .sidebar-nav {
    background-color: var(--card);
  }

  .nav-link {
    color: var(--muted-foreground);
    transition: all 0.2s ease;

    &:hover {
      background-color: var(--muted);
      color: var(--foreground);
    }

    &.active {
      background-color: var(--secondary);
      color: var(--foreground);
      font-weight: 500;
    }
  }

  .nav-title {
    color: var(--muted-foreground);
    font-size: var(--font-size-xs);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
}

// Table styling
.table {
  color: var(--foreground);

  thead th {
    background-color: var(--muted);
    border-bottom: 1px solid var(--border);
    font-weight: 500;
    font-size: var(--font-size-xs);
    color: var(--muted-foreground);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 0.75rem 1rem;
  }

  tbody td {
    border-bottom: 1px solid var(--border);
    padding: 0.75rem 1rem;
    font-size: var(--font-size-sm);
  }

  tbody tr:hover {
    background-color: var(--muted);
  }
}

// Dark mode adjustments
@include color-mode(dark) {
  body {
    background-color: var(--background);
    color: var(--foreground);
  }

  .footer {
    --cui-footer-bg: var(--card);
    background-color: var(--card);
  }

  .sidebar {
    background-color: var(--card);
    border-right-color: var(--border);
  }
}

// Container spacing
.container-fluid {
  padding-right: var(--container-padding);
  padding-left: var(--container-padding);
}

// Utility spacing classes
.mb-4 {
  margin-bottom: var(--spacing-lg);
}

.mt-4 {
  margin-top: var(--spacing-lg);
}

.p-4 {
  padding: var(--spacing-lg);
}

// Card spacing adjustments
.custom-card {
  margin-bottom: var(--spacing-lg);
}

// === Comprehensive CoreUI Overrides ===

// Sidebar overrides
.shadcn-sidebar {
  background-color: var(--card) !important;
  border-right: 1px solid var(--border) !important;
  border-left: none !important;

  .shadcn-sidebar-header {
    background-color: var(--card) !important;
    // border-bottom: 1px solid var(--border) !important;
    padding: var(--spacing-lg) !important;
    min-height: var(--header-height) !important;
  }

  .shadcn-sidebar-brand {
    color: var(--foreground) !important;
    text-decoration: none !important;
  }

  .shadcn-sidebar-footer {
    background-color: var(--card) !important;
    border-top: 1px solid var(--border) !important;
    padding: var(--spacing-md) !important;
    margin-top: auto;

    .shadcn-user-menu {
      width: 100%;
      background-color: transparent !important;
      border: 1px solid var(--border) !important;
      border-radius: var(--radius-md) !important;
      padding: var(--spacing-sm) var(--spacing-md) !important;
      color: var(--foreground) !important;
      text-align: left;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;

      &:hover {
        background-color: var(--muted) !important;
        border-color: var(--muted-foreground) !important;
      }

      &::after {
        display: none;
      }
    }

    .shadcn-user-avatar {
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      background-color: var(--secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--foreground);
      flex-shrink: 0;
    }

    .shadcn-user-name {
      font-size: var(--font-size-sm);
      font-weight: 500;
      color: var(--foreground);
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .shadcn-user-email {
      font-size: var(--font-size-xs);
      color: var(--muted-foreground);
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }

  .shadcn-sidebar-toggler {
    background-color: transparent !important;
    border: 1px solid var(--border) !important;
    color: var(--muted-foreground) !important;
    border-radius: var(--radius-md) !important;

    &:hover {
      background-color: var(--muted) !important;
    }
  }

  .shadcn-close-btn {
    color: var(--foreground) !important;
    background-color: transparent !important;
    border: none !important;

    &:hover {
      background-color: var(--muted) !important;
    }
  }
}

// CoreUI Button overrides
.btn, button[class*="btn-"] {
  font-family: var(--font-sans);
  font-weight: 500;
  border-radius: var(--radius-md);
  transition: all 0.2s ease;

  &.btn-primary {
    background-color: var(--primary) !important;
    border-color: var(--primary) !important;
    color: var(--primary-foreground) !important;

    &:hover {
      opacity: 0.9;
    }
  }

  &.btn-danger {
    background-color: var(--destructive) !important;
    border-color: var(--destructive) !important;
    color: var(--destructive-foreground) !important;
  }

  &.btn-secondary {
    background-color: var(--secondary) !important;
    border-color: var(--border) !important;
    color: var(--secondary-foreground) !important;
  }
}

// CoreUI Card overrides
.card {
  background-color: var(--card) !important;
  border: 1px solid var(--border) !important;
  border-radius: var(--radius-lg) !important;
  box-shadow: var(--shadow-sm) !important;
  color: var(--card-foreground) !important;

  .card-header {
    background-color: var(--card) !important;
    border-bottom: 1px solid var(--border) !important;
    padding: var(--spacing-lg) !important;
    color: var(--foreground) !important;
    font-weight: 600;
  }

  .card-body {
    background-color: var(--card) !important;
    color: var(--foreground) !important;
  }

  .card-footer {
    background-color: var(--card) !important;
    border-top: 1px solid var(--border) !important;
    color: var(--muted-foreground) !important;
  }
}

// Form controls
.form-control, .form-select {
  background-color: var(--background) !important;
  border: 1px solid var(--input) !important;
  color: var(--foreground) !important;
  border-radius: var(--radius-md) !important;
  font-family: var(--font-sans);
  transition: all 0.2s ease;

  &:focus {
    border-color: var(--ring) !important;
    box-shadow: 0 0 0 3px rgba(24, 24, 27, 0.1) !important;
    background-color: var(--background) !important;
  }

  &::placeholder {
    color: var(--muted-foreground);
  }
}

// Badges
.badge {
  font-family: var(--font-sans);
  font-weight: 500;
  border-radius: var(--radius-sm);
  padding: 0.25rem 0.625rem;

  &.bg-primary {
    background-color: var(--primary) !important;
    color: var(--primary-foreground) !important;
  }

  &.bg-success {
    background-color: #22c55e !important;
    color: #ffffff !important;
  }

  &.bg-danger {
    background-color: var(--destructive) !important;
    color: var(--destructive-foreground) !important;
  }

  &.bg-warning {
    background-color: #f59e0b !important;
    color: #ffffff !important;
  }

  &.bg-info {
    background-color: #3b82f6 !important;
    color: #ffffff !important;
  }

  &.bg-secondary {
    background-color: var(--secondary) !important;
    color: var(--secondary-foreground) !important;
  }
}

// Progress bars
.progress {
  background-color: var(--muted) !important;
  border-radius: var(--radius-md);
  height: 0.5rem;

  .progress-bar {
    background-color: var(--primary) !important;
    transition: width 0.3s ease;

    &.bg-success {
      background-color: #22c55e !important;
    }

    &.bg-info {
      background-color: #3b82f6 !important;
    }

    &.bg-warning {
      background-color: #f59e0b !important;
    }

    &.bg-danger {
      background-color: var(--destructive) !important;
    }
  }
}

// Dropdown menus
.dropdown-menu {
  background-color: var(--card) !important;
  border: 1px solid var(--border) !important;
  border-radius: var(--radius-lg) !important;
  box-shadow: var(--shadow-lg) !important;
  padding: var(--spacing-xs) !important;

  .dropdown-item {
    color: var(--foreground) !important;
    border-radius: var(--radius-md) !important;
    padding: var(--spacing-sm) var(--spacing-md) !important;
    font-size: var(--font-size-sm);
    transition: all 0.2s ease;

    &:hover {
      background-color: var(--muted) !important;
    }

    &.active, &:active {
      background-color: var(--secondary) !important;
      color: var(--foreground) !important;
    }
  }

  .dropdown-divider {
    border-color: var(--border) !important;
    margin: var(--spacing-xs) 0 !important;
  }
}

// Nav links and tabs
.nav-link {
  color: var(--muted-foreground) !important;
  font-weight: 500;
  transition: all 0.2s ease;

  &:hover {
    color: var(--foreground) !important;
  }

  &.active {
    color: var(--foreground) !important;
    background-color: var(--secondary) !important;
  }
}

// Header specific overrides
.header {
  .container-fluid {
    background-color: rgba(255, 255, 255, 0.8) !important;
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);

    @media (prefers-color-scheme: dark) {
      background-color: rgba(9, 9, 11, 0.8) !important;
    }

    [data-coreui-theme="dark"] & {
      background-color: rgba(9, 9, 11, 0.8) !important;
    }
  }
}

// Breadcrumb
.breadcrumb {
  background-color: transparent !important;
  padding: 0 !important;
  margin: 0 !important;

  .breadcrumb-item {
    color: var(--muted-foreground) !important;
    font-size: var(--font-size-sm);

    &.active {
      color: var(--foreground) !important;
    }

    a {
      color: var(--muted-foreground) !important;
      text-decoration: none;

      &:hover {
        color: var(--foreground) !important;
      }
    }

    + .breadcrumb-item::before {
      color: var(--muted-foreground) !important;
    }
  }
}

// Alert components
.alert {
  border-radius: var(--radius-lg);
  border: 1px solid var(--border);
  padding: var(--spacing-md);
  font-size: var(--font-size-sm);

  &.alert-primary {
    background-color: rgba(24, 24, 27, 0.1);
    color: var(--foreground);
    border-color: var(--border);
  }

  &.alert-danger {
    background-color: rgba(239, 68, 68, 0.1);
    color: var(--destructive);
    border-color: var(--destructive);
  }

  &.alert-success {
    background-color: rgba(34, 197, 94, 0.1);
    color: #16a34a;
    border-color: #22c55e;
  }
}

// Modal overrides
.modal-content {
  background-color: var(--card) !important;
  border: 1px solid var(--border) !important;
  border-radius: var(--radius-xl) !important;
  box-shadow: var(--shadow-xl) !important;

  .modal-header {
    background-color: var(--card) !important;
    border-bottom: 1px solid var(--border) !important;
    color: var(--foreground) !important;
  }

  .modal-body {
    background-color: var(--card) !important;
    color: var(--foreground) !important;
  }

  .modal-footer {
    background-color: var(--card) !important;
    border-top: 1px solid var(--border) !important;
  }
}

// List groups
.list-group-item {
  background-color: var(--card) !important;
  border-color: var(--border) !important;
  color: var(--foreground) !important;

  &:hover {
    background-color: var(--muted) !important;
  }

  &.active {
    background-color: var(--secondary) !important;
    border-color: var(--border) !important;
    color: var(--foreground) !important;
  }
}

// === CoreUI Utility Class Overrides ===
// Override CoreUI's default background utilities to use CSS variables

// Background utilities
.bg-white,
.bg-light {
  background-color: var(--background) !important;
}

.bg-body {
  background-color: var(--background) !important;
}

.bg-dark {
  background-color: var(--card) !important;
}

.bg-body-secondary,
.bg-body-tertiary {
  background-color: var(--muted) !important;
}

// Text color utilities
.text-body,
.text-dark {
  color: var(--foreground) !important;
}

.text-body-secondary,
.text-body-tertiary,
.text-secondary {
  color: var(--muted-foreground) !important;
}

.text-light,
.text-white {
  color: var(--foreground) !important;
}

// Border utilities
.border,
.border-top,
// .border-bottom,
.border-start,
.border-end {
  border-color: var(--border) !important;
}

.border-light {
  border-color: var(--border) !important;
}

.border-dark {
  border-color: var(--muted-foreground) !important;
}

// Ensure all container elements respect dark mode
div,
section,
article,
main,
aside {
  &:not([class*="bg-"]) {
    // background-color: inherit;
    color: inherit;
  }
}

// Tables
.table {
  --cui-table-color: var(--foreground) !important;
  --cui-table-bg: transparent !important;
  --cui-table-border-color: var(--border) !important;
  --cui-table-striped-bg: var(--muted) !important;
  --cui-table-hover-bg: var(--muted) !important;
  color: var(--foreground) !important;

  thead {
    color: var(--foreground) !important;
    border-color: var(--border) !important;
  }

  tbody {
    color: var(--foreground) !important;
    border-color: var(--border) !important;
  }

  th, td {
    color: var(--foreground) !important;
    border-color: var(--border) !important;
  }
}

// Ensure text in various elements uses correct colors
p, span, div, label, li, td, th {
  &:not([class*="text-"]):not([class*="bg-"]) {
    color: inherit;
  }
}
